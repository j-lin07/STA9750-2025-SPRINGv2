<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jeanne Lin">

<title>MP01 Submission – STA 9750 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-8dbebb1f0b5d5fe07de0bb45451a9a1c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MP01 Submission</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jeanne Lin </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>This document details the process for downloading, reading, cleaning, and analyzing the NYC payroll data in R for the MP01 project. The steps include:</p>
<ol type="1">
<li>Downloading the data if it does not already exist.</li>
<li>Reading and cleaning the data using the <strong>readr</strong>, <strong>dplyr</strong>, and <strong>stringr</strong> packages.</li>
<li>Creating a summary table for Eric L. Adams’ career.</li>
<li>Calculating the total compensation for each employee.</li>
</ol>
</section>
<section id="downloading-the-data" class="level1">
<h1>1. Downloading the Data</h1>
<p>The code below checks if the data file exists. If not, it creates the required directory, downloads the data in batches from the NYC API, and writes the combined data to a CSV file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">"data/mp01/nyc_payroll_export.csv"</span>)){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">"data/mp01"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  ENDPOINT <span class="ot">&lt;-</span> <span class="st">"https://data.cityofnewyork.us/resource/k397-673e.json"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"httr2"</span>)) <span class="fu">install.packages</span>(<span class="st">"httr2"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(httr2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"jsonlite"</span>)) <span class="fu">install.packages</span>(<span class="st">"jsonlite"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(jsonlite)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"dplyr"</span>)) <span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(dplyr)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"readr"</span>)) <span class="fu">install.packages</span>(<span class="st">"readr"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(readr)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  BATCH_SIZE <span class="ot">&lt;-</span> <span class="dv">50000</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  OFFSET     <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  END_OF_EXPORT <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  ALL_DATA <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span>(<span class="sc">!</span>END_OF_EXPORT){</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">"Requesting items"</span>, OFFSET, <span class="st">"to"</span>, BATCH_SIZE <span class="sc">+</span> OFFSET, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    req <span class="ot">&lt;-</span> <span class="fu">request</span>(ENDPOINT) <span class="sc">|&gt;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">req_url_query</span>(<span class="st">`</span><span class="at">$limit</span><span class="st">`</span>  <span class="ot">=</span> BATCH_SIZE, </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                    <span class="st">`</span><span class="at">$offset</span><span class="st">`</span> <span class="ot">=</span> OFFSET)</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    resp <span class="ot">&lt;-</span> <span class="fu">req_perform</span>(req)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    batch_data <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="fu">resp_body_string</span>(resp))</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    ALL_DATA <span class="ot">&lt;-</span> <span class="fu">c</span>(ALL_DATA, <span class="fu">list</span>(batch_data))</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">NROW</span>(batch_data) <span class="sc">!=</span> BATCH_SIZE){</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>      END_OF_EXPORT <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="st">"End of Data Export Reached</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>      OFFSET <span class="ot">&lt;-</span> OFFSET <span class="sc">+</span> BATCH_SIZE</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>  ALL_DATA <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(ALL_DATA)</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Data export complete:"</span>, <span class="fu">NROW</span>(ALL_DATA), <span class="st">"rows and"</span>, <span class="fu">NCOL</span>(ALL_DATA), <span class="st">"columns.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_csv</span>(ALL_DATA, <span class="st">"data/mp01/nyc_payroll_export.csv"</span>)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Data file already exists.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Data file already exists.</code></pre>
</div>
</div>
</section>
<section id="reading-and-cleaning-the-data" class="level1">
<h1>Reading and Cleaning the Data</h1>
<p>This section reads the CSV file using readr and cleans the data by converting key text columns to title case using stringr.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'readr' was built under R version 4.4.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.4.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 6225611 Columns: 17
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (8): agency_name, last_name, first_name, mid_init, work_location_boroug...
dbl  (8): fiscal_year, payroll_number, base_salary, regular_hours, regular_g...
dttm (1): agency_start_date

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6,225,611
Columns: 17
$ fiscal_year                &lt;dbl&gt; 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2…
$ payroll_number             &lt;dbl&gt; 67, 67, 67, 67, 67, 67, 67, 67, 67, 67, 67,…
$ agency_name                &lt;chr&gt; "Admin For Children's Svcs", "Admin For Chi…
$ last_name                  &lt;chr&gt; "Faye Fall", "Kilgore", "Wisdom", "Miller",…
$ first_name                 &lt;chr&gt; "Sokhna", "Orlantha", "Cherise", "Moya-Gaye…
$ mid_init                   &lt;chr&gt; "M", "B", "M", "S", "M", "L", "O", NA, "N",…
$ agency_start_date          &lt;dttm&gt; 2023-11-20, 2023-08-28, 2022-10-24, 2023-0…
$ work_location_borough      &lt;chr&gt; "Bronx", "Brooklyn", "Manhattan", "Manhatta…
$ title_description          &lt;chr&gt; "Child Protective Specialist", "Child Prote…
$ leave_status_as_of_june_30 &lt;chr&gt; "Active", "Active", "On Leave", "On Leave",…
$ base_salary                &lt;dbl&gt; 62043, 62043, 43144, 62043, 60236, 62043, 6…
$ pay_basis                  &lt;chr&gt; "per Annum", "per Annum", "per Annum", "per…
$ regular_hours              &lt;dbl&gt; 1050.00, 1470.00, 1251.50, 1400.75, 700.00,…
$ regular_gross_paid         &lt;dbl&gt; 31267.96, 44660.96, 28649.20, 44515.43, 221…
$ ot_hours                   &lt;dbl&gt; 12.00, 99.75, 30.00, 44.75, 53.00, 146.00, …
$ total_ot_paid              &lt;dbl&gt; 425.00, 3859.84, 802.42, 1476.98, 1933.33, …
$ total_other_pay            &lt;dbl&gt; 78.04, 78.14, 78.26, 78.37, 78.47, 78.86, 7…</code></pre>
</div>
</div>
</section>
<section id="creating-a-summary-table-for-eric-l.-adams-career" class="level1">
<h1>Creating a Summary Table for Eric L. Adams’ Career</h1>
<p>This section filters the data to include only records for Eric L. Adams, groups the data by fiscal year, and calculates his total base salary for each year.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 4
   `Fiscal Year` `Total Salary` Position          Agency                    
           &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;                     
 1          2014         160000 Borough President Borough President-Brooklyn
 2          2015         160000 Borough President Borough President-Brooklyn
 3          2016         179200 Borough President Borough President-Brooklyn
 4          2017         179200 Borough President Borough President-Brooklyn
 5          2018         179200 Borough President Borough President-Brooklyn
 6          2019         179200 Borough President Borough President-Brooklyn
 7          2020         179200 Borough President Borough President-Brooklyn
 8          2021         179200 Borough President Borough President-Brooklyn
 9          2022         437950 Borough President Borough President-Brooklyn
10          2023         258750 Mayor             Office Of The Mayor       
11          2024         258750 Mayor             Office Of The Mayor       </code></pre>
</div>
</div>
</section>
<section id="calculating-total-compensation-for-each-employee" class="level1">
<h1>Calculating Total Compensation for Each Employee</h1>
<p>This section adds a new column total_compensation to the payroll data frame using a series of conditions:</p>
<p>First condition: For Eric L. Adams, the total compensation is his fixed base_salary. Second condition: If an employee has overtime hours, calculate regular pay as base_salary * regular_hours and overtime pay as base_salary * ot_hours * 1.5, then add them together. Third condition: For all other cases, assume a day rate payment computed as base_salary * ((regular_hours + ot_hours) / 7.5).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 18
  fiscal_year payroll_number agency_name           last_name first_name mid_init
        &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;                 &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;   
1        2024             67 Admin For Children's… Faye Fall Sokhna     M       
2        2024             67 Admin For Children's… Kilgore   Orlantha   B       
3        2024             67 Admin For Children's… Wisdom    Cherise    M       
4        2024             67 Admin For Children's… Miller    Moya-Gaye  S       
5        2024             67 Admin For Children's… Bradley   Yashika    M       
6        2024             67 Admin For Children's… Maurino   Jennifer   L       
# ℹ 12 more variables: agency_start_date &lt;dttm&gt;, work_location_borough &lt;chr&gt;,
#   title_description &lt;chr&gt;, leave_status_as_of_june_30 &lt;chr&gt;,
#   base_salary &lt;dbl&gt;, pay_basis &lt;chr&gt;, regular_hours &lt;dbl&gt;,
#   regular_gross_paid &lt;dbl&gt;, ot_hours &lt;dbl&gt;, total_ot_paid &lt;dbl&gt;,
#   total_other_pay &lt;dbl&gt;, total_compensation &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="additional-analysis" class="level1">
<h1>Additional Analysis</h1>
<p>In this section, we calculate an annualized base pay for each job title and identify the individual with the highest total city payroll.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  title_description max_annual_base
  &lt;chr&gt;                       &lt;dbl&gt;
1 Chair                      414707</code></pre>
</div>
</div>
<p>In this section, we calcuate the indiviual with the most overtime hours.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  first_name last_name   fiscal_year ot_hours
  &lt;chr&gt;      &lt;chr&gt;             &lt;dbl&gt;    &lt;dbl&gt;
1 James      Internicola        2022    3693.</code></pre>
</div>
</div>
<p>In this section, we calculate which agency has the highest average total annual payroll (base and overtime pay per employee).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  agency_name                    avg_total_pay
  &lt;chr&gt;                                  &lt;dbl&gt;
1 Office Of Collective Bargainin    190936482.</code></pre>
</div>
</div>
<p>In this section, we calculate many employees are in each agency and then each fiscal_year, keep only the agency with the maximum employee count.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,705 × 3
   fiscal_year agency_name                    num_employees
         &lt;dbl&gt; &lt;chr&gt;                                  &lt;int&gt;
 1        2014 Dept Of Ed Pedagogical                100589
 2        2014 Dept Of Ed Per Session Teacher         76334
 3        2014 Police Department                      55619
 4        2014 Board Of Election Poll Workers         33241
 5        2014 Dept Of Ed Para Professionals          27556
 6        2014 Dept Of Ed Hrly Support Staff          23056
 7        2014 Fire Department                        16555
 8        2014 Dept Of Parks &amp; Recreation             15120
 9        2014 Hra/Dept Of Social Services            14765
10        2014 Department Of Education Admin          13905
# ℹ 1,695 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
   fiscal_year agency_name            num_employees
         &lt;dbl&gt; &lt;chr&gt;                          &lt;int&gt;
 1        2014 Dept Of Ed Pedagogical        100589
 2        2015 Dept Of Ed Pedagogical        111857
 3        2016 Dept Of Ed Pedagogical        106263
 4        2017 Dept Of Ed Pedagogical        104629
 5        2018 Dept Of Ed Pedagogical        107956
 6        2019 Dept Of Ed Pedagogical        112067
 7        2020 Dept Of Ed Pedagogical        114999
 8        2021 Dept Of Ed Pedagogical        113523
 9        2022 Dept Of Ed Pedagogical        120453
10        2023 Dept Of Ed Pedagogical        106882
11        2024 Dept Of Ed Pedagogical        108209</code></pre>
</div>
</div>
<p>In this section, we calculate which agency has the highest overtime usage (compared to regular hours).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 4
  agency_name       total_overtime total_regular overtime_ratio
  &lt;chr&gt;                      &lt;dbl&gt;         &lt;dbl&gt;          &lt;dbl&gt;
1 Board Of Election       3062029.     15339960.          0.200</code></pre>
</div>
</div>
<p>In this section, we calculate how much has the city’s aggregate payroll grown over the past 10 years.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 2
   fiscal_year total_payroll
         &lt;dbl&gt;         &lt;dbl&gt;
 1        2014       2.31e13
 2        2015       2.42e13
 3        2016       2.54e13
 4        2017       2.69e13
 5        2018       2.74e13
 6        2019       2.84e13
 7        2020       3.04e13
 8        2021       3.02e13
 9        2022       3.11e13
10        2023       3.08e13
11        2024       3.02e13</code></pre>
</div>
</div>
</section>
<section id="policy-analysis" class="level1">
<h1>Policy Analysis</h1>
<p>Policy I: Capping Salaries at Mayoral Level For each fiscal year, identify the mayor’s total compensation.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
   fiscal_year mayor_total
         &lt;dbl&gt;       &lt;dbl&gt;
 1        2022      179200
 2        2021      179200
 3        2020      179200
 4        2019      179200
 5        2018      179200
 6        2017      179200
 7        2016      179200
 8        2015      160000
 9        2014      160000
10        2024      258750
11        2023      258750
12        2022      258750</code></pre>
</div>
</div>
<p>For every other employee in that same year who earned more than the mayor, compute how much would be “saved” if their pay were capped at the mayor’s salary.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(payroll, mayor_pay, by = "fiscal_year"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 17197 of `x` matches multiple rows in `y`.
ℹ Row 10 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,838,619 × 21
   fiscal_year payroll_number agency_name          last_name first_name mid_init
         &lt;dbl&gt;          &lt;dbl&gt; &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt;   
 1        2024             67 Admin For Children'… Faye Fall Sokhna     M       
 2        2024             67 Admin For Children'… Kilgore   Orlantha   B       
 3        2024             67 Admin For Children'… Wisdom    Cherise    M       
 4        2024             67 Admin For Children'… Miller    Moya-Gaye  S       
 5        2024             67 Admin For Children'… Bradley   Yashika    M       
 6        2024             67 Admin For Children'… Maurino   Jennifer   L       
 7        2024             67 Admin For Children'… Kelly     Princess   O       
 8        2024             67 Admin For Children'… Ojo       Abiodun    &lt;NA&gt;    
 9        2024             67 Admin For Children'… Nelson    Cassandra  N       
10        2024             67 Admin For Children'… Adjaero   Alphonsus  A       
# ℹ 6,838,609 more rows
# ℹ 15 more variables: agency_start_date &lt;dttm&gt;, work_location_borough &lt;chr&gt;,
#   title_description &lt;chr&gt;, leave_status_as_of_june_30 &lt;chr&gt;,
#   base_salary &lt;dbl&gt;, pay_basis &lt;chr&gt;, regular_hours &lt;dbl&gt;,
#   regular_gross_paid &lt;dbl&gt;, ot_hours &lt;dbl&gt;, total_ot_paid &lt;dbl&gt;,
#   total_other_pay &lt;dbl&gt;, total_compensation &lt;dbl&gt;, mayor_total &lt;dbl&gt;,
#   capped_compensation &lt;dbl&gt;, savings &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Summarize the total savings, and identify which agencies and job titles would be most affected.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 3
   fiscal_year total_savings employees_capped
         &lt;dbl&gt;         &lt;dbl&gt;            &lt;int&gt;
 1        2014       2.31e13           188943
 2        2015       2.41e13           190947
 3        2016       2.54e13           197543
 4        2017       2.68e13           205251
 5        2018       2.73e13           206711
 6        2019       2.83e13           209553
 7        2020       3.04e13           210565
 8        2021       3.01e13           202510
 9        2022       6.22e13           410600
10        2023       3.08e13           202028
11        2024       3.01e13           191372</code></pre>
</div>
</div>
<p>In each fiscal year, a significant total amount would be saved if every employee earning above the mayor’s annual compensation were capped at that level. For example, in fiscal years such as 2014 through 2024, tens of trillions (in your data’s units) could be saved, and hundreds of thousands of employees would be affected.</p>
<p>Recommendation: While the financial savings appear substantial, this policy would impact a large number of employees across various agencies and job titles. Before adopting the policy, consider the following points:</p>
<p>Cost Savings vs.&nbsp;Operational Impact: The potential payroll savings are impressive, but capping salaries might have unintended consequences on recruitment, retention, and employee morale; especially for positions where the market rate for talent exceeds the mayor’s salary.</p>
<p>Agency-Specific Impacts: The analysis identifies certain agencies and job titles that would bear the brunt of this policy. A one-size-fits-all cap might not account for the differences in responsibilities or market conditions across departments.</p>
<p>Equity and Incentives: While the policy promotes fiscal discipline, it could also limit incentives for experienced professionals and high-performing staff who may be essential for maintaining efficient service delivery.</p>
<p>Policy III: Limit overtime hours for hourly employees. For example, cap overtime to 10 hours per week per employee.</p>
<p>Calculations: Current Overtime Expense: Use data to sum the overtime cost for all employees using the current formula:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  total_overtime_cost
                &lt;dbl&gt;
1             4.04e13</code></pre>
</div>
</div>
<p>Adjusted Overtime Expense: If the cap is 10 hours per week, then over 52 weeks that’s 520 overtime hours maximum per employee. Then recalculate overtime pay:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  total_adjusted_overtime_cost
                         &lt;dbl&gt;
1                      3.55e13</code></pre>
</div>
</div>
<p>Staffing Adjustments: If overtime is capped, some employees may not be able to cover all required hours. The city may need to hire additional staff to cover the gap in service hours.</p>
<p>Recommendation: If the savings from reduced overtime outweigh the cost of hiring additional employees and if service levels can be maintained this policy could reduce payroll expenses. I would recommend piloting the cap in selected departments to evaluate real-world impacts before full implementation.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/j-lin07\.github\.io\/STA9750-2025-SPRINGv2\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>